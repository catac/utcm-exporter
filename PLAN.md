As generated by Gemini

# Iterative Implementation Plan
To ensure your AI agent doesn't hallucinate or build a massive script that fails all at once, instruct it to implement the project in these specific milestones:

Step 1: Authentication & Basic Connectivity
Prompt to AI: "Set up the project structure and manage dependencies with uv (install msal, requests, python-dotenv via uv), then write auth.py. Write a test script to authenticate and simply GET https://graph.microsoft.com/v1.0/organization to prove authentication works."

Validation: Run the script. If it prints your tenant details, your .env and App Registration are correct.

Step 2: Triggering and Polling the UTCM API
Prompt to AI: "Create utcm_client.py. Implement the POST request to createSnapshot using a tiny payload of just two resources: microsoft.entra.conditionalaccesspolicy and microsoft.entra.grouplifecyclepolicy. Implement the polling mechanism to check the job status until it succeeds, and print the resourceLocation URL."

Validation: Run it. It should take 30â€“60 seconds to poll and output a temporary download URL. Manually open the URL in your browser to inspect the raw JSON structure of the snapshot so you understand exactly how Microsoft formats the payload.

Step 3: Downloading and Unpacking (File System Operations)
Prompt to AI: "Implement parser.py. Add code to download the JSON from the resourceLocation URL. Then, parse the JSON and write it to the directory structure defined in AGENTS.md. Ensure JSON keys are sorted for consistent diffing."

Validation: Run the script. Check your local directory to ensure folders like entra/conditionalaccesspolicy/ are created and contain beautifully formatted .json files.

Step 4: Automating Git Historization
Prompt to AI: "Update the main orchestrator script. After unpacking the JSON files, use the subprocess module or GitPython to run git add ., check if there are any diffs, and if so, run git commit -m "Automated UTCM backup: <timestamp>"."

Validation: Modify a conditional access policy in your M365 tenant. Run the script. Check your git log and git diff to ensure the script caught the change and created a new commit showing exactly what was modified.

Step 5: Scaling up to All Resources
Prompt to AI: "Extract the list of all UTCM supported resources into a resources.json config file. Update the snapshot POST request to read from this file so we export the entire tenant configuration."

Validation: Run the full export. Ensure the script doesn't hit timeouts (you may need to increase the polling timeout window to 5-10 minutes for a full 300-resource tenant snapshot).
